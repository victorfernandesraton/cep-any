var C=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var B=Object.prototype.hasOwnProperty;var G=(r,e,t)=>e in r?C(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var X=(r,e)=>{for(var t in e)C(r,t,{get:e[t],enumerable:!0})},D=(r,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of M(e))!B.call(r,s)&&s!==t&&C(r,s,{get:()=>e[s],enumerable:!(o=L(e,s))||o.enumerable});return r};var H=r=>D(C({},"__esModule",{value:!0}),r);var a=(r,e,t)=>(G(r,typeof e!="symbol"?e+"":e,t),t);var K={};X(K,{Cep:()=>O,CepService:()=>z,Provider:()=>J,cep:()=>I,factory:()=>F});module.exports=H(K);var n=class{constructor({cep:e,street:t,city:o,state:s,neighborhood:p}){this.cep=e,this.street=t,this.city=o,this.state=s,this.neighborhood=p}static create({cep:e,street:t,city:o,state:s,neighborhood:p}){return new n({cep:e,street:t,city:o,state:s,neighborhood:p})}};var y=class extends Error{};var d=class extends y{constructor(e){super(`invalid params ${e}`)}};var c=class{constructor(e){a(this,"baseUrl","");this.api=e}generalParse(e){return e.replaceAll("-","")}validateCep(e){if(!/[0-9]{8}/.test(e))throw new d(e)}async execute(e){let t=this.generalParse(e);return this.validateCep(t),await this.handler(e)}async handler(e){throw new Error("not implemented")}};a(c,"api");var f=class{constructor(e){a(this,"services");this.services=e}async execute(e){try{return await Promise.any(this.services.map(o=>o.execute(e)))}catch{throw new Error("error in execute cep")}}};function m({url:r,method:e="GET",body:t,params:o,headers:s}){let p=new URLSearchParams,l={method:e,body:t,headers:s};if(o)for(let u in o)p.set(u,o[u]);let v=`${r}?${p.toString()}`;return fetch(v,l)}function S(r){var e;return n.create({cep:r.code.replaceAll("-",""),city:r.city,state:r.state,neighborhood:(e=r.district)!=null?e:"",street:r.address})}var g=class extends c{constructor(){super("apicep"),this.baseUrl="https://ws.apicep.com/cep.json"}async handler(e){let t=await m({url:this.baseUrl,params:{code:e}}),o=await t.json();if(!t.ok)throw new Error(o);return S(o)}};function $(r){return n.create({...r})}var T=class extends c{constructor(){super("brasilAPI"),this.baseUrl="https://brasilapi.com.br/api/cep/v1/"}async handler(e){let t=await m({url:`${this.baseUrl}/${e}`}),o=await t.json();if(!t.ok)throw new Error(o);return $(o)}};var x=class extends Error{constructor(t,o){super(o);a(this,"api","");this.api=t}};function q(r){return`<?xml version="1.0"?>
	<soapenv:Envelope 		xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:cli="http://cliente.bean.master.sigep.bsb.correios.com.br/">  <soapenv:Header />  <soapenv:Body>    <cli:consultaCEP>      <cep>${r}</cep>    </cli:consultaCEP>  </soapenv:Body></soapenv:Envelope>`}function A(r){var e,t,o,s,p,l,v;try{let u=(t=(e=r.replace(/\r?\n|\r/g,"").match(/<return>(.*)<\/return>/))==null?void 0:e[0])!=null?t:"";if(u=="")throw new x(`invalid regex got ${r}`,"correios");let i=u.replace("<return>","").replace("</return>","").split(/</).reduce((P,k)=>{let h=k.split(">");return h.length>1&&h[1].trim().length&&(P[h==null?void 0:h[0]]=h[1]),P},{});if((i==null?void 0:i.cep)===""||!(i!=null&&i.cep))throw new x("not returnd a cep to parse","correios");return n.create({cep:(o=i.cep)!=null?o:"",state:(s=i.uf)!=null?s:"",city:(p=i.cidade)!=null?p:"",street:(l=i.bairro)!=null?l:"",neighborhood:(v=i.end)!=null?v:""})}catch{throw new x("not implement xml","correios")}}var E=class extends c{constructor(){super("correios"),this.baseUrl="https://apps.correios.com.br"}async handler(e){let t=await m({url:`${this.baseUrl}/SigepMasterJPA/AtendeClienteService/AtendeCliente`,body:q(e),method:"POST",headers:{"Content-Type":"application/xml"}}),o=await t.text();if(!t.ok)throw new Error(o);return A(o)}};function R(r){var e,t,o,s,p,l;return n.create({cep:(t=(e=r==null?void 0:r.cep)==null?void 0:e.replace("-",""))!=null?t:"",state:(o=r==null?void 0:r.uf)!=null?o:"",city:(s=r==null?void 0:r.localidade)!=null?s:"",street:(p=r==null?void 0:r.logradouro)!=null?p:"",neighborhood:(l=r==null?void 0:r.bairro)!=null?l:""})}var b=class extends c{constructor(){super("viacep"),this.baseUrl="https://viacep.com.br"}async handler(e){let t=await m({url:`${this.baseUrl}/ws/${e}/json`,method:"GET"}),o=await t.json();if(!t.ok)throw new Error(o);return R(o)}};a(b,"baseUrl");function U({useDefaultProviders:r=!0,custonProviders:e}){let t=[];return r&&(t=[new b,new T,new g,new E]),e!=null&&e.length&&(t=[...t,...e]),new f(t)}var j=r=>U({useDefaultProviders:!0}).execute(r);var w={Cep:n,cep:j,CepService:c,Provider:f,factory:U};var I=w.cep,J=w.Provider,O=w.Cep,z=w.CepService,F=w.factory;0&&(module.exports={Cep,CepService,Provider,cep,factory});
