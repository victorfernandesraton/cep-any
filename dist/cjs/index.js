"use strict";var h=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var A=Object.getOwnPropertyNames;var j=Object.prototype.hasOwnProperty;var k=(r,e,t)=>e in r?h(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var L=(r,e)=>{for(var t in e)h(r,t,{get:e[t],enumerable:!0})},M=(r,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of A(e))!j.call(r,s)&&s!==t&&h(r,s,{get:()=>e[s],enumerable:!(o=$(e,s))||o.enumerable});return r};var B=r=>M(h({},"__esModule",{value:!0}),r);var d=(r,e,t)=>(k(r,typeof e!="symbol"?e+"":e,t),t);var O={};L(O,{Cep:()=>D,CepService:()=>H,Provider:()=>X,Requester:()=>J,cep:()=>G,factory:()=>I});module.exports=B(O);var n=class{constructor({cep:e,street:t,city:o,state:s,neighborhood:i}){this.cep=e,this.street=t,this.city=o,this.state=s,this.neighborhood=i}static create({cep:e,street:t,city:o,state:s,neighborhood:i}){return new n({cep:e,street:t,city:o,state:s,neighborhood:i})}};var x=class extends Error{};var w=class extends x{constructor(e){super(`invalid params ${e}`)}};function c({url:r,method:e="GET",body:t,params:o,headers:s}){let i=new URLSearchParams,m={method:e,body:t,headers:s};if(o)for(let g in o)i.set(g,o[g]);let U=`${r}?${i.toString()}`;return fetch(U,m)}var p=class{baseUrl="";constructor(e,t=c){this.api=e,this.requester=t}generalParse(e){return e.replaceAll("-","")}validateCep(e){if(!/[0-9]{8}/.test(e))throw new w(e)}async execute(e){let t=this.generalParse(e);return this.validateCep(t),await this.handler(e)}async handler(e){throw new Error("not implemented")}};d(p,"api");var l=class{services;constructor(e){this.services=e}async execute(e){return await Promise.any(this.services.map(o=>o.execute(e)))}};function q(r){return n.create({cep:r.code.replaceAll("-",""),city:r.city,state:r.state,neighborhood:r.district??"",street:r.address})}var v=class extends p{constructor(){super("apicep"),this.baseUrl="https://ws.apicep.com/cep.json"}async handler(e){let t=await c({url:this.baseUrl,params:{code:e}}),o=await t.json();if(!t.ok)throw new Error(o);return q(o)}};function P(r){return n.create({...r})}var C=class extends p{constructor(){super("brasilAPI"),this.baseUrl="https://brasilapi.com.br/api/cep/v1/"}async handler(e){let t=await this.requester({url:`${this.baseUrl}/${e}`}),o=await t.json();if(!t.ok)throw new Error(o);return P(o)}};var u=class extends Error{api="";constructor(e,t){t?super(t):super(),this.api=e}};function S(r){return`<?xml version="1.0"?>
	<soapenv:Envelope 		xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:cli="http://cliente.bean.master.sigep.bsb.correios.com.br/">  <soapenv:Header />  <soapenv:Body>    <cli:consultaCEP>      <cep>${r}</cep>    </cli:consultaCEP>  </soapenv:Body></soapenv:Envelope>`}function E(r){try{let e=r.replace(/\r?\n|\r/g,"").match(/<return>(.*)<\/return>/)?.[0]??"";if(e=="")throw new u(`invalid regex got ${r}`,"correios");let o=e.replace("<return>","").replace("</return>","").split(/</).reduce((s,i)=>{let m=i.split(">");return m.length>1&&m[1].trim().length&&(s[m?.[0]]=m[1]),s},{});if(o?.cep===""||!o?.cep)throw new u("not returnd a cep to parse","correios");return n.create({cep:o.cep??"",state:o.uf??"",city:o.cidade??"",street:o.bairro??"",neighborhood:o.end??""})}catch{throw new u("not implement xml","correios")}}var b=class extends p{constructor(){super("correios"),this.baseUrl="https://apps.correios.com.br"}async handler(e){let t=await this.requester({url:`${this.baseUrl}/SigepMasterJPA/AtendeClienteService/AtendeCliente`,body:S(e),method:"POST",headers:{"Content-Type":"application/xml"}}),o=await t.text();if(!t.ok)throw new Error(o);return E(o)}};function T(r){return n.create({cep:r?.cep?.replace("-","")??"",state:r?.uf??"",city:r?.localidade??"",street:r?.logradouro??"",neighborhood:r?.bairro??""})}var f=class extends p{constructor(){super("viacep"),this.baseUrl="https://viacep.com.br"}async handler(e){let t=await this.requester({url:`${this.baseUrl}/ws/${e}/json`,method:"GET"}),o=await t.json();if(!t.ok)throw new Error(o);return T(o)}};d(f,"baseUrl");function y({useDefaultProviders:r=!0,custonProviders:e,requester:t=c}){let o=[];return r&&(o=[new f,new C,new v,new b]),e?.length&&(o=[...o,...e]),t&&(o=[...o.map(s=>(s.requester=t,s))]),new l(o)}var R=r=>y({useDefaultProviders:!0}).execute(r);var a={Cep:n,cep:R,CepService:p,Provider:l,factory:y,Requester:c};var G=a.cep,X=a.Provider,D=a.Cep,H=a.CepService,I=a.factory,J=a.Requester;0&&(module.exports={Cep,CepService,Provider,Requester,cep,factory});
