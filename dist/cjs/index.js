var f=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var A=Object.getOwnPropertyNames;var j=Object.prototype.hasOwnProperty;var k=(r,e,t)=>e in r?f(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var L=(r,e)=>{for(var t in e)f(r,t,{get:e[t],enumerable:!0})},M=(r,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of A(e))!j.call(r,s)&&s!==t&&f(r,s,{get:()=>e[s],enumerable:!(o=q(e,s))||o.enumerable});return r};var B=r=>M(f({},"__esModule",{value:!0}),r);var d=(r,e,t)=>(k(r,typeof e!="symbol"?e+"":e,t),t);var J={};L(J,{Cep:()=>D,CepService:()=>H,Provider:()=>X,cep:()=>G,factory:()=>I});module.exports=B(J);var n=class{constructor({cep:e,street:t,city:o,state:s,neighborhood:c}){this.cep=e,this.street=t,this.city=o,this.state=s,this.neighborhood=c}static create({cep:e,street:t,city:o,state:s,neighborhood:c}){return new n({cep:e,street:t,city:o,state:s,neighborhood:c})}};var x=class extends Error{};var w=class extends x{constructor(e){super(`invalid params ${e}`)}};var p=class{baseUrl="";constructor(e){this.api=e}generalParse(e){return e.replaceAll("-","")}validateCep(e){if(!/[0-9]{8}/.test(e))throw new w(e)}async execute(e){let t=this.generalParse(e);return this.validateCep(t),await this.handler(e)}async handler(e){throw new Error("not implemented")}};d(p,"api");var m=class{services;constructor(e){this.services=e}async execute(e){try{return await Promise.any(this.services.map(o=>o.execute(e)))}catch{throw new Error("error in execute cep")}}};function i({url:r,method:e="GET",body:t,params:o,headers:s}){let c=new URLSearchParams,a={method:e,body:t,headers:s};if(o)for(let g in o)c.set(g,o[g]);let $=`${r}?${c.toString()}`;return fetch($,a)}function E(r){return n.create({cep:r.code.replaceAll("-",""),city:r.city,state:r.state,neighborhood:r.district??"",street:r.address})}var v=class extends p{constructor(){super("apicep"),this.baseUrl="https://ws.apicep.com/cep.json"}async handler(e){let t=await i({url:this.baseUrl,params:{code:e}}),o=await t.json();if(!t.ok)throw new Error(o);return E(o)}};function P(r){return n.create({...r})}var b=class extends p{constructor(){super("brasilAPI"),this.baseUrl="https://brasilapi.com.br/api/cep/v1/"}async handler(e){let t=await i({url:`${this.baseUrl}/${e}`}),o=await t.json();if(!t.ok)throw new Error(o);return P(o)}};var l=class extends Error{api="";constructor(e,t){super(t),this.api=e}};function S(r){return`<?xml version="1.0"?>
	<soapenv:Envelope 		xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:cli="http://cliente.bean.master.sigep.bsb.correios.com.br/">  <soapenv:Header />  <soapenv:Body>    <cli:consultaCEP>      <cep>${r}</cep>    </cli:consultaCEP>  </soapenv:Body></soapenv:Envelope>`}function T(r){try{let e=r.replace(/\r?\n|\r/g,"").match(/<return>(.*)<\/return>/)?.[0]??"";if(e=="")throw new l(`invalid regex got ${r}`,"correios");let o=e.replace("<return>","").replace("</return>","").split(/</).reduce((s,c)=>{let a=c.split(">");return a.length>1&&a[1].trim().length&&(s[a?.[0]]=a[1]),s},{});if(o?.cep===""||!o?.cep)throw new l("not returnd a cep to parse","correios");return n.create({cep:o.cep??"",state:o.uf??"",city:o.cidade??"",street:o.bairro??"",neighborhood:o.end??""})}catch{throw new l("not implement xml","correios")}}var C=class extends p{constructor(){super("correios"),this.baseUrl="https://apps.correios.com.br"}async handler(e){let t=await i({url:`${this.baseUrl}/SigepMasterJPA/AtendeClienteService/AtendeCliente`,body:S(e),method:"POST",headers:{"Content-Type":"application/xml"}}),o=await t.text();if(!t.ok)throw new Error(o);return T(o)}};function U(r){return n.create({cep:r?.cep?.replace("-","")??"",state:r?.uf??"",city:r?.localidade??"",street:r?.logradouro??"",neighborhood:r?.bairro??""})}var h=class extends p{constructor(){super("viacep"),this.baseUrl="https://viacep.com.br"}async handler(e){let t=await i({url:`${this.baseUrl}/ws/${e}/json`,method:"GET"}),o=await t.json();if(!t.ok)throw new Error(o);return U(o)}};d(h,"baseUrl");function y({useDefaultProviders:r=!0,custonProviders:e}){let t=[];return r&&(t=[new h,new b,new v,new C]),e?.length&&(t=[...t,...e]),new m(t)}var R=r=>y({useDefaultProviders:!0}).execute(r);var u={Cep:n,cep:R,CepService:p,Provider:m,factory:y};var G=u.cep,X=u.Provider,D=u.Cep,H=u.CepService,I=u.factory;0&&(module.exports={Cep,CepService,Provider,cep,factory});
