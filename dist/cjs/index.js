"use strict";var l=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var T=Object.prototype.hasOwnProperty;var E=(s,e,t)=>e in s?l(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var U=(s,e)=>{for(var t in e)l(s,t,{get:e[t],enumerable:!0})},$=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of S(e))!T.call(s,o)&&o!==t&&l(s,o,{get:()=>e[o],enumerable:!(r=R(e,o))||r.enumerable});return s};var k=s=>$(l({},"__esModule",{value:!0}),s);var b=(s,e,t)=>(E(s,typeof e!="symbol"?e+"":e,t),t);var A={};U(A,{CepService:()=>n,Provider:()=>p,Requester:()=>a,cep:()=>P,factory:()=>x});module.exports=k(A);var h=class extends Error{constructor(e){super(e)}};var d=class extends h{constructor(e){super(`invalid params ${e}`)}};function a({url:s,method:e="GET",body:t,params:r,headers:o}){let m=new URLSearchParams,i={method:e,body:t,headers:o};if(r)for(let y in r)m.set(y,r[y]);let C=`${s}?${m.toString()}`;return fetch(C,i)}var n=class{api;requester;baseUrl="";constructor(e,t=a){this.api=e,this.requester=t}overrideRequest(e){this.requester=e}generalParse(e){return e.replaceAll("-","")}validateCep(e){if(!/[0-9]{8}/.test(e))throw new d(e)}async execute(e){let t=this.generalParse(e);return this.validateCep(t),await this.handler(e)}};var p=class{services;constructor(e){this.services=e}async execute(e){return await Promise.any(this.services.map(r=>r.execute(e)))}};var f=class extends n{constructor(){super("apicep"),this.baseUrl="https://ws.apicep.com/cep.json"}async handler(e){let t=await a({url:this.baseUrl,params:{code:e}}),r=await t.json();if(!t.ok)throw new Error(r);return{cep:r.code.replaceAll("-",""),city:r.city,state:r.state,neighborhood:r.district??"",street:r.address}}};var w=class extends n{constructor(){super("brasilAPI"),this.baseUrl="https://brasilapi.com.br/api/cep/v1/"}async handler(e){let t=await this.requester({url:`${this.baseUrl}/${e}`}),r=await t.json();if(!t.ok)throw new Error(r);return{...r}}};var c=class extends Error{api="";constructor(e,t){t?super(t):super(),this.api=e}};function g(s){return`<?xml version="1.0"?>
	<soapenv:Envelope 		xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:cli="http://cliente.bean.master.sigep.bsb.correios.com.br/">  <soapenv:Header />  <soapenv:Body>    <cli:consultaCEP>      <cep>${s}</cep>    </cli:consultaCEP>  </soapenv:Body></soapenv:Envelope>`}function q(s){try{let e=s.replace(/\r?\n|\r/g,"").match(/<return>(.*)<\/return>/)?.[0]??"";if(e=="")throw new c(`invalid regex got ${s}`,"correios");let r=e.replace("<return>","").replace("</return>","").split(/</).reduce((o,m)=>{let i=m.split(">");return i.length>1&&i[1].trim().length&&(o[i?.[0]]=i[1]),o},{});if(r?.cep===""||!r?.cep)throw new c("not returnd a cep to parse","correios");return{cep:r.cep??"",state:r.uf??"",city:r.cidade??"",street:r.bairro??"",neighborhood:r.end??""}}catch{throw new c("not implement xml","correios")}}var v=class extends n{constructor(){super("correios"),this.baseUrl="https://apps.correios.com.br"}async handler(e){let t=await this.requester({url:`${this.baseUrl}/SigepMasterJPA/AtendeClienteService/AtendeCliente`,body:g(e),method:"POST",headers:{"Content-Type":"application/xml"}}),r=await t.text();if(!t.ok)throw new Error(r);return q(r)}};var u=class extends n{constructor(){super("viacep"),this.baseUrl="https://viacep.com.br"}async handler(e){let t=await this.requester({url:`${this.baseUrl}/ws/${e}/json`,method:"GET"}),r=await t.json();if(!t.ok)throw new Error(r);return{cep:r?.cep?.replace("-","")??"",state:r?.uf??"",city:r?.localidade??"",street:r?.logradouro??"",neighborhood:r?.bairro??""}}};b(u,"baseUrl");function x({useDefaultProviders:s=!0,custonProviders:e,requester:t=a}){let r=[];return s&&(r=[new u,new w,new f,new v]),e?.length&&(r=[...r,...e]),t&&(r=[...r.map(o=>(o.overrideRequest(t),o))]),new p(r)}var P=s=>x({useDefaultProviders:!0}).execute(s);0&&(module.exports={CepService,Provider,Requester,cep,factory});
