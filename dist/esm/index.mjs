var U=Object.defineProperty;var $=(r,e,o)=>e in r?U(r,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[e]=o;var h=(r,e,o)=>($(r,typeof e!="symbol"?e+"":e,o),o);var s=class{constructor({cep:e,street:o,city:t,state:p,neighborhood:i}){this.cep=e,this.street=o,this.city=t,this.state=p,this.neighborhood=i}static create({cep:e,street:o,city:t,state:p,neighborhood:i}){return new s({cep:e,street:o,city:t,state:p,neighborhood:i})}};var d=class extends Error{};var x=class extends d{constructor(e){super(`invalid params ${e}`)}};function c({url:r,method:e="GET",body:o,params:t,headers:p}){let i=new URLSearchParams,m={method:e,body:o,headers:p};if(t)for(let y in t)i.set(y,t[y]);let R=`${r}?${i.toString()}`;return fetch(R,m)}var n=class{baseUrl="";constructor(e,o=c){this.api=e,this.requester=o}generalParse(e){return e.replaceAll("-","")}validateCep(e){if(!/[0-9]{8}/.test(e))throw new x(e)}async execute(e){let o=this.generalParse(e);return this.validateCep(o),await this.handler(e)}async handler(e){throw new Error("not implemented")}};h(n,"api");var l=class{services;constructor(e){this.services=e}async execute(e){return await Promise.any(this.services.map(t=>t.execute(e)))}};function g(r){return s.create({cep:r.code.replaceAll("-",""),city:r.city,state:r.state,neighborhood:r.district??"",street:r.address})}var w=class extends n{constructor(){super("apicep"),this.baseUrl="https://ws.apicep.com/cep.json"}async handler(e){let o=await c({url:this.baseUrl,params:{code:e}}),t=await o.json();if(!o.ok)throw new Error(t);return g(t)}};function q(r){return s.create({...r})}var v=class extends n{constructor(){super("brasilAPI"),this.baseUrl="https://brasilapi.com.br/api/cep/v1/"}async handler(e){let o=await this.requester({url:`${this.baseUrl}/${e}`}),t=await o.json();if(!o.ok)throw new Error(t);return q(t)}};var u=class extends Error{api="";constructor(e,o){o?super(o):super(),this.api=e}};function P(r){return`<?xml version="1.0"?>
	<soapenv:Envelope 		xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:cli="http://cliente.bean.master.sigep.bsb.correios.com.br/">  <soapenv:Header />  <soapenv:Body>    <cli:consultaCEP>      <cep>${r}</cep>    </cli:consultaCEP>  </soapenv:Body></soapenv:Envelope>`}function S(r){try{let e=r.replace(/\r?\n|\r/g,"").match(/<return>(.*)<\/return>/)?.[0]??"";if(e=="")throw new u(`invalid regex got ${r}`,"correios");let t=e.replace("<return>","").replace("</return>","").split(/</).reduce((p,i)=>{let m=i.split(">");return m.length>1&&m[1].trim().length&&(p[m?.[0]]=m[1]),p},{});if(t?.cep===""||!t?.cep)throw new u("not returnd a cep to parse","correios");return s.create({cep:t.cep??"",state:t.uf??"",city:t.cidade??"",street:t.bairro??"",neighborhood:t.end??""})}catch{throw new u("not implement xml","correios")}}var C=class extends n{constructor(){super("correios"),this.baseUrl="https://apps.correios.com.br"}async handler(e){let o=await this.requester({url:`${this.baseUrl}/SigepMasterJPA/AtendeClienteService/AtendeCliente`,body:P(e),method:"POST",headers:{"Content-Type":"application/xml"}}),t=await o.text();if(!o.ok)throw new Error(t);return S(t)}};function E(r){return s.create({cep:r?.cep?.replace("-","")??"",state:r?.uf??"",city:r?.localidade??"",street:r?.logradouro??"",neighborhood:r?.bairro??""})}var f=class extends n{constructor(){super("viacep"),this.baseUrl="https://viacep.com.br"}async handler(e){let o=await this.requester({url:`${this.baseUrl}/ws/${e}/json`,method:"GET"}),t=await o.json();if(!o.ok)throw new Error(t);return E(t)}};h(f,"baseUrl");function b({useDefaultProviders:r=!0,custonProviders:e,requester:o=c}){let t=[];return r&&(t=[new f,new v,new w,new C]),e?.length&&(t=[...t,...e]),o&&(t=[...t.map(p=>(p.requester=o,p))]),new l(t)}var T=r=>b({useDefaultProviders:!0}).execute(r);var a={Cep:s,cep:T,CepService:n,Provider:l,factory:b,Requester:c};var Ge=a.cep,Xe=a.Provider,De=a.Cep,He=a.CepService,Ie=a.factory,Je=a.Requester;export{De as Cep,He as CepService,Xe as Provider,Je as Requester,Ge as cep,Ie as factory};
