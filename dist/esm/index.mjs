var m=class extends Error{constructor(e){super(e)}};var u=class extends m{constructor(e){super(`invalid params ${e}`)}};var o=class s{constructor(e,t){this.api=e;this.requester=t;this.api=e}baseUrl="";overrideRequest(e){this.requester=e}static generalParse(e){return e.replaceAll("-","").replaceAll(".","")}static validateCep(e){return/[0-9]{8}/.test(e)}async execute(e){let t="";typeof e=="number"?t=e.toString():t=e;let r=s.generalParse(t);if(!s.validateCep(r))throw new u(r);return this.handler(r)}};var p=class{services;constructor(e){this.services=e}async execute(e){return await Promise.any(this.services.map(r=>r.execute(e)))}};var c=class{async execute({url:e,body:t,headers:r,method:a,params:x}){let n=new URLSearchParams(x),R={method:a,body:t,headers:r},q=`${e}?${n.toString()}`;return fetch(q,R)}};var l=class extends o{constructor(e){super("apicep",e),this.baseUrl="https://ws.apicep.com/cep.json"}async handler(e){let t=await this.requester.execute({url:this.baseUrl,params:{code:e}}),r=await t.json();if(!t.ok)throw new Error(...r);return{cep:r.code.replaceAll("-",""),city:r.city,state:r.state,neighborhood:r.district??"",street:r.address}}};var d=class extends o{constructor(e){super("brasilAPI",e),this.baseUrl="https://brasilapi.com.br/api/cep/v1"}async handler(e){let t=await this.requester.execute({url:`${this.baseUrl}/${e}`}),r=await t.json();if(!t.ok)throw new Error(r);return{...r}}};var i=class extends Error{api="";constructor(e,t){t?super(t):super(),this.api=e}};function w(s){return`<?xml version="1.0"?>
	<soapenv:Envelope 		xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:cli="http://cliente.bean.master.sigep.bsb.correios.com.br/">  <soapenv:Header />  <soapenv:Body>    <cli:consultaCEP>      <cep>${s}</cep>    </cli:consultaCEP>  </soapenv:Body></soapenv:Envelope>`}function b(s){try{let e=s.replace(/\r?\n|\r/g,"").match(/<return>(.*)<\/return>/)?.[0]??"";if(e=="")throw new i(`invalid regex got ${s}`,"correios");let r=e.replace("<return>","").replace("</return>","").split(/</).reduce((a,x)=>{let n=x.split(">");return n.length>1&&n[1].trim().length&&(a[n?.[0]]=n[1]),a},{});if(r?.cep===""||!r?.cep)throw new i("not returnd a cep to parse","correios");return{cep:r.cep??"",state:r.uf??"",city:r.cidade??"",street:r.bairro??"",neighborhood:r.end??""}}catch{throw new i("not implement xml","correios")}}var h=class extends o{constructor(e){super("correios",e),this.baseUrl="https://apps.correios.com.br"}async handler(e){let t=await this.requester.execute({url:`${this.baseUrl}/SigepMasterJPA/AtendeClienteService/AtendeCliente`,body:w(e),method:"POST",headers:{"Content-Type":"application/xml"}}),r=await t.text();if(!t.ok)throw new Error(r);return b(r)}};var f=class extends o{static baseUrl;constructor(e){super("viacep",e),this.baseUrl="https://viacep.com.br"}async handler(e){let t=await this.requester.execute({url:`${this.baseUrl}/ws/${e}/json`,method:"GET"}),r=await t.json();if(!t.ok)throw new Error(r);return{cep:r?.cep?.replace("-","")??"",state:r?.uf??"",city:r?.localidade??"",street:r?.logradouro??"",neighborhood:r?.bairro??""}}};function v({useDefaultProviders:s=!0,custonProviders:e,requester:t=new c}){let r=[];return s&&(r=[new f(t),new d(t),new l(t),new h(t)]),e?.length&&(r=[...r,...e]),t&&(r=[...r.map(a=>(a.overrideRequest(t),a))]),new p(r)}var y=s=>v({useDefaultProviders:!0}).execute(s);export{o as CepService,p as Provider,c as RequestWIthFetch,y as cep,v as factory};
